@Library('piper-lib') _
@Library('features-pipeline-lib') __

stage("voter") {
	node() {
		checkout scm
		load "Jenkinsfile_Voter"
	}
}

stage("Security"){
	devxPodTemplate() {
		checkout scm
		sh "npm install"
		executeCheckmarxScan script: this, checkmarxProject: 'CodeValidation_checkmarx', checkmarxGroupId: 'f8bb43bd-9a38-4e6a-a932-6a8159817e41'
	}
}

stage("Release"){
    def version_extension
	def commitId
	node() {
		checkout scm
		def piperUtils = new com.sap.icd.jenkins.Utils();
		commitId = piperUtils.getGitCommitId();
		def utils = new com.sap.devx.featurelib.Utils();
        version_extension = "${utils.gitCommitTimestamp(commitId)}+${commitId}"
	}
	node() {
	triggerXMakeRemoteJob(		
 		xMakeServer: "xmake-nova",		
 		xMakeJobName: "devx/DevX-CodeValidation-SP-REL-common_indirectshipment",		
 		xMakeJobParameters: "MODE=stage_and_promote\nTREEISH=${commitId}"		
 	)
	}
}
